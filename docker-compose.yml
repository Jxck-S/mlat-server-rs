services:
  mlat-server-rs:
    build: .
    container_name: mlat-server-rs
    restart: always
    # Increase max open files (ulimit -n) to handle high concurrency (thousands of connections)
    ulimits:
      nofile:
        soft: 8000
        hard: 8000
    ports:
      - "31090:31090"   # Client input (Beast/Raw)
      - "30104:30104"   # BaseStation output
      - "8080:8080"     # HTTP file server (work-dir JSON: sync.json, clients.json, aircraft.json)
    # Run as root so the work-dir volume is always writable (optional; default is user mlat)
    # user: root
    # Persist work dir (sync.json, clients.json, aircraft.json) on the host
    volumes:
      - ./work:/run/mlat-server-rs
    environment:
      - HTTP_PORT=8080
      - WORK_DIR=/run/mlat-server-rs
    # Command arguments are passed directly to mlat-server via docker-entrypoint.sh
    command:
      - --client-listen
      - "31090"
      - --filtered-basestation-listen
      - "30104"
      - --work-dir
      - /run/mlat-server-rs
